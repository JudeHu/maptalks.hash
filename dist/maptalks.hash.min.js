/*!
 * maptalks.hash v0.1.1
 * LICENSE : MIT
 * (c) 2016-2017 maptalks.org
 */
/*!
 * requires maptalks@>=0.31.0 
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("maptalks")):"function"==typeof define&&define.amd?define(["exports","maptalks"],t):t(e.maptalks=e.maptalks||{},e.maptalks)}(this,function(e,t){"use strict";function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):function(e,t){for(var o=Object.getOwnPropertyNames(t),n=0;n<o.length;n++){var i=o[n],a=Object.getOwnPropertyDescriptor(t,i);a&&a.configurable&&void 0===e[i]&&Object.defineProperty(e,i,a)}}(e,t))}var n=function(e){function n(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this));o._map=t,o._view=o._map.getView(),o.bindEvent(),o.updateView();var i=o.viewToHash(o._view);return o.setHash(i),o}return o(n,e),n.prototype.bindEvent=function(){t.DomUtil.addDomEvent(window,"hashchange",this.onHashChange,this),this._map.on("viewchange",this.onViewChange,this)},n.prototype.setHash=function(e){window.location.hash=e},n.prototype.getHash=function(){return window.location.hash},n.prototype.getView=function(){return this._map.getView()},n.prototype.setView=function(e){e=Object.assign(this._view,e),this._map.setView(e)},n.prototype.updateView=function(){var e=this.getHash(),t=this.hashToView(e);t&&this._map.setView(t)},n.prototype.onHashChange=function(){this.updateView()},n.prototype.onViewChange=function(e){var t=this.viewToHash(e.new);t!==this.getHash()&&(console.log(t,this.getHash()),this.setHash(t))},n.prototype.hashToView=function(e){0===e.indexOf("#")&&(e=e.substr(1));var t=e.split("/");if(5!==t.length)return!1;var o=t[0],n=t[1],i=t[2],a=t[3],r=t[4];if(o=parseInt(o),n=parseInt(n),i=parseInt(i),a=parseFloat(a),r=parseFloat(r),!(!isNaN(o)&&o>=1&&o<=21&&!isNaN(n)&&n>=0&&n<=90&&!isNaN(i)&&i>=-180&&i<=180&&!isNaN(a)&&a>=-180&&a<=180&&!isNaN(r)&&r>=-90&&r<=90))return!1;this.setView({center:[a,r],zoom:o,pitch:n,bearing:i})},n.prototype.viewToHash=function(e){var o=Math.max(0,Math.ceil(Math.log(e.zoom)/Math.LN2));return t.StringUtil.replaceVariable("#{zoom}/{pitch}/{bearing}/{x}/{y}",{zoom:e.zoom,pitch:parseInt(e.pitch),bearing:parseInt(e.bearing),x:e.center[0].toFixed(o),y:e.center[1].toFixed(o)})},n}(t.Class);e.Hash=n,Object.defineProperty(e,"__esModule",{value:!0}),"undefined"!=typeof console&&console.log("maptalks.hash v0.1.1, requires maptalks@>=0.31.0.")});